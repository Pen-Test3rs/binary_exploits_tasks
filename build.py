#!/usr/bin/env python3
import os
import json


flags = dict()

with open('config.json') as json_file:
    data = json.load(json_file)
    if not 'flags' in data:
        raise Exception("No flags in config")
    flags: dict = data['flags']

tasks = [ (f.name, f.path) for f in os.scandir('tasks') if f.is_dir() ]
for (task_name, path) in tasks:
    print(task_name)
    task_number = task_name[:2]
    flag = flags.get(task_number)
    if flag is None:
        flag = "default_flag"

    with open(f'{path}/flag.txt', "w") as file:
        file.write(f'flAGH{{{flag}}}\n')
    
    os.system(f'cp Dockerfile {path}')
    os.system(f'cp nsjail.sh {path}')
    os.system(f'cd {path} && make')

print("Programs ready!")