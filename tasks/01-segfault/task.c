#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <signal.h>
#include <unistd.h>

void segfault_handler()
{
  printf("You raised segmentation fault and crashed the program.\n");
  printf("Remember not to use 'gets' function in your programs. Never.\n");
  printf("Here is your flag:\n");
  system("cat ./flag.txt");
  printf("\n");
  exit(1);
}

int main(int argc, char *argv[]) {
  struct sigaction segfaulthandler;
  setvbuf(stdout, NULL, _IONBF, 0);
  setvbuf(stdin, NULL, _IONBF, 0);

  segfaulthandler.sa_handler = segfault_handler;
  sigemptyset(&segfaulthandler.sa_mask);
  segfaulthandler.sa_flags = 0;
  sigaction(SIGSEGV, &segfaulthandler, NULL);
  char name[16];
  printf("Greeter:\n");
  printf("---------------\n");
  printf("Please enter your name: ");
  gets(name);
  printf("\nNice to meet you %s...\n", name);
  return 0;
}

