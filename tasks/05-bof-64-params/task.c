#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <stdint.h>

void print_flag(int p1, uint64_t p2){
    printf("You passed the following arguments:\n");
    printf("p1 = %d\n", p1);
    printf("p2 = 0x%lX\n", p2);

    FILE *f = NULL;
    char flag[64];

    if(p1 == -1337){
        f = fopen("./flag.txt", "rt");
        if (f == NULL)
            return;
    }

    if(p2 == 0xBAADC0DEBAADC0DE){
        fgets(flag, sizeof(flag), f);
        puts(flag);
    }

    if(f != NULL){
        fclose(f);
    }
}

void vuln(){
    puts("Function call 64bit:");
    puts("---------------");

    char buf[32];
    read(STDIN_FILENO, buf, 128);

    print_flag(-1, 2);
}

int main(int argc, char *argv[]){
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stdin, NULL, _IONBF, 0);

    vuln();

    return 0;
}
