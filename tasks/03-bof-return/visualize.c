#include <stdio.h>
#include <string.h>

#define ROWS 7
#define COLS 8

#define C_RED "31"
#define C_YELLOW "33"
#define C_GREEN "32"
#define C_BLUE "34"
#define C_WHITE "37"
#define B_RED "101"

#define T_ESC(body) "\x1b[" body "m"
#define T_END "m"
#define T_BRIGHT ";1"
#define TC_RESET T_ESC()
#define TC_WHITE T_ESC(C_WHITE T_BRIGHT)
#define TC_ERROR T_ESC(B_RED T_BRIGHT ";" C_WHITE)

const char *row_colors[] = {
    [0 ... 3] = C_GREEN,
    [4] = C_WHITE,
    [5] = C_YELLOW,
    [6] = C_WHITE,
};

char expected[ROWS * COLS];

void init_visualize(char *buff)
{
    for (int i = 0; i < ROWS * COLS; i++)
        expected[i] = buff[i];
}

void visualize(char *buff)
{
    int i = 0;
    char format_str[20];

    puts("");
    puts("Legend: " T_ESC(C_GREEN T_BRIGHT) "buffer " T_ESC(C_YELLOW T_BRIGHT) "return address\n" TC_RESET);
    for (int r = 0; r < ROWS; r++)
    {
        printf("%p " TC_WHITE "| ", buff + r * COLS);
        for (int c = 0; c < COLS; c++)
        {
            sprintf(format_str, T_ESC("0;%s%s"), row_colors[r], (buff[i] == expected[i]) ? "" : T_BRIGHT);
            printf("%s%02x" TC_RESET " ", format_str, buff[i] & 0xff);
            i++;
        }
        puts(TC_WHITE "|" TC_RESET);
    }
    puts("");
}
