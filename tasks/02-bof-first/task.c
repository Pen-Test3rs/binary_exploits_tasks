#include <stdlib.h>
#include <stdio.h>
#include <string.h>

void init_visualize(char *buff);
void visualize(char *buff);

int main(int argc, char *argv[]){
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stdin, NULL, _IONBF, 0);

    puts("First buffer overflow:");
    puts("---------------");

    int x = 0x12345678;
    char buffer[16];
    memset(buffer, 0, sizeof(buffer));
    init_visualize(buffer);

    printf("Here is current stack: ");
    visualize(buffer);

    puts("Please fill the buffer (16 bytes) with text and change the value of secret variable to 35455565 (hex), so that the program flow changes:");
    gets(buffer);
    visualize(buffer);

    if (x == 0x35455565){
        puts("You changed the program flow by overwriting variable on stack.");
        puts("Here is the flag:");
        system("cat ./flag.txt");
        return 0;
    }
    puts("\nNothing happened. Try again.");

    return 0;
}
